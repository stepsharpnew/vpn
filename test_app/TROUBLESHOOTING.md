# Решение проблемы "Connection refused" на Android эмуляторе

## Проблема
Ошибка: `Client exception with socketException. Connection refused`
`address = localhost`
`uri=http://localhost:8000/connect/request`

## Что я изменил:

1. **Добавил CORS в FastAPI** (`backend/app/main.py`) - чтобы мобильное приложение могло обращаться к API
2. **Изменил URL** в `test_app/lib/constants/app_constants.dart` на `http://10.0.2.2:8000` для Android эмулятора

## Пошаговая проверка:

### Шаг 1: Убедитесь, что бэкенд запущен правильно

Откройте терминал и выполните:

```bash
cd backend
uv run uvicorn app.main:app --host=0.0.0.0 --port=8000 --reload
```

**ВАЖНО**: Должен быть `--host=0.0.0.0`, а не `--host=127.0.0.1` или `localhost`!

Вы должны увидеть что-то вроде:
```
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process
INFO:     Started server process
INFO:     Waiting for application startup.
INFO:     Application startup complete.
```

### Шаг 2: Проверьте URL в коде

Откройте файл `test_app/lib/constants/app_constants.dart` и убедитесь, что строка 29 содержит:

```dart
static const String apiBaseUrl = 'http://10.0.2.2:8000'; // Android эмулятор
```

**НЕ** используйте `localhost` или `127.0.0.1` для Android эмулятора!

### Шаг 3: Перезапустите Flutter приложение

После изменения URL **обязательно** перезапустите приложение:

1. Остановите приложение (если запущено) - нажмите `q` в терминале или закройте его
2. Выполните `flutter pub get` (если еще не делали)
3. Запустите заново: `flutter run`

### Шаг 4: Проверьте, что бэкенд доступен

Откройте в браузере на вашем компьютере:
- `http://localhost:8000/docs` - должна открыться Swagger документация

Если не открывается - бэкенд не запущен или запущен неправильно.

## Почему `10.0.2.2`?

Android эмулятор использует специальную сетевую конфигурацию:
- `10.0.2.2` - это специальный IP, который указывает на `localhost` вашего компьютера из эмулятора
- `localhost` в эмуляторе указывает на само эмулятор, а не на ваш компьютер

## Если все еще не работает:

1. **Проверьте, что бэкенд действительно запущен:**
   - Откройте `http://localhost:8000/docs` в браузере
   - Должна открыться Swagger документация

2. **Проверьте, что используете правильный URL:**
   - Для Android эмулятора: `http://10.0.2.2:8000`
   - НЕ `http://localhost:8000`
   - НЕ `http://127.0.0.1:8000`

3. **Убедитесь, что перезапустили приложение** после изменения URL

4. **Проверьте логи бэкенда** - возможно там есть ошибки

5. **Проверьте файрвол** - возможно он блокирует порт 8000

## Быстрая проверка:

Выполните в терминале (на вашем компьютере):
```bash
curl http://localhost:8000/docs
```

Если это работает, но приложение не может подключиться - проблема в URL. Используйте `10.0.2.2` вместо `localhost`.

